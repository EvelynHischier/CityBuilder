<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">

<html>
    
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
        <title>amCharts examples</title>
        <link rel="stylesheet" href="style.css" type="text/css">
        <script src="../amcharts/amcharts.js" type="text/javascript"></script>
        <script src="../amcharts/funnel.js" type="text/javascript"></script>
        <script type="text/javascript">
			//Properties, methods and events: http://docs.amcharts.com/3/javascriptcharts/AmFunnelChart
			var chart;
			
			configChart = function() {
				chart = new AmCharts.AmFunnelChart();
				chart.rotate = true;
				chart.titleField = "title";
				chart.balloonText = "";
				chart.pullDistance = 0;
				chart.marginRight = 210;
				chart.marginLeft = 15;
				chart.labelPosition = "right";
				chart.funnelAlpha = 0.9;
				chart.valueField = "value";
				chart.startX = -500;
				chart.labelText = "[[title]]: [[value]] ([[percents]]%)";
				chart.labelText = "[[title]]";
				chart.colors = ["#C3C3C3", "#D2F079", "#F36971", "#39B7FB", "#FADAA9", "#B962B9", "#FDFBB5"];
				/*
				Colors:
				#C3C3C3 = grey
				#D2F079 = green
				#F36971 = red
				#39B7FB = blue
				#FADAA9 = piggy orange :)
				#B962B9 = violet
				#FDFBB5 = yellow
				*/
				chart.borderAlpha = 1;
				chart.startAlpha = 0;
				chart.valueRepresents = "height";
				chart.write("chartdiv");
			};
			
			if(AmCharts.isReady) {
				configChart();
			} else {
				AmCharts.ready(configChart);
			}
			
        </script>
    </head>
    
    <body>
        <div id="chartdiv" style="width: 500px; height: 300px;"></div>
		<div>
			<table border="0">
			<tr>
				<td>Available population</td>
				<td><input type="number" id="txt_popavailable" value="1200" readonly /></td>
			</tr>
			<tr>
				<td>Kings</td>
				<td><input type="number" id="txt1" onBlur="updatePyramid()" /></td>
			</tr>
			<tr>
				<td>Priests</td>
				<td><input type="number" id="txt2" onBlur="updatePyramid()" /></td>
			</tr>
			<tr>
				<td>Craftsmen</td>
				<td><input type="number" id="txt3" onBlur="updatePyramid()" /></td>
			</tr>
			<tr>
				<td>Scribes</td>
				<td><input type="number" id="txt4" onBlur="updatePyramid()" /></td>
			</tr>
			<tr>
				<td>Soldiers</td>
				<td><input type="number" id="txt5" onBlur="updatePyramid()" /></td>
			</tr>
			<tr>
				<td>Peasants</td>
				<td><input type="number" id="txt6" onBlur="updatePyramid()" /></td>
			</tr>
			<tr>
				<td>Slaves</td>
				<td><input type="number" id="txt7" onBlur="updatePyramid()" /></td>
			</tr>
			<tr>
				<td>Sum</td>
				<td><input type="number" id="txt8" readonly /></td>
			</tr>
			</table>
			<script type="text/javascript">
				var popAvailable = 1200;
				function updatePyramid()
				{
					var sum = 0;
					var scribesResearched = true;
					var population = new Array(7);
					
					//If writing is not researched, no scribes can be assigned
					if(!scribesResearched)
						document.getElementById("txt4").setAttribute("readonly", "true");
					
					//Putting all the numbers from the text fields in an array
					for(var i = 0, j = 7; i < population.length; i++, j--) {
						population[i] = Number(document.getElementById("txt" + j).value);
						sum += population[i];
					}
					
					document.getElementById("txt8").setAttribute("value", sum);
					
					//Data for the pyramid chart
					var data = [
					{
						"title": "Slaves",
						"value": population[0]
					},
					{
						"title": "Peasants",
						"value": population[1]
					},
					{
						"title": "Soldiers",
						"value": population[2]
					},
					{
						"title": "Scribes",
						"value": population[3]
					},
					{
						"title": "Craftsmen",
						"value": population[4]
					},
					{
						"title": "Priests",
						"value": population[5]
					},
					{
						"title": "King",
						"value": population[6]
					}];

					for(var i = 0; i < data.length; i++) {
						
						if(data[i].value / sum < 0.0625) {//less than 6.25%
							data[i].value = popAvailable*0.0625;
						}
						
						if(data[i].value / sum > 0.625) {//greater than 62.5%
							data[i].value = popAvailable*0.625;
						}
					}
					
					if(sum > popAvailable) {
						alert("You cannot assign more people than available!");
						document.getElementById("txt_popavailable").value = 0;
					}
					else
						document.getElementById("txt_popavailable").value = popAvailable - sum;
					
					chart.dataProvider = data;
					chart.validateData();
				}
			</script>
		</div>
    </body>

</html>